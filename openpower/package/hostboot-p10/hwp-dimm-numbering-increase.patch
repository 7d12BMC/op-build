From 11fd4136bc3c1912b631be08cec1563aa30a58ea Mon Sep 17 00:00:00 2001
From: Stephen Glancy <sglancy@us.ibm.com>
Date: Thu, 16 Dec 2021 16:34:17 -0500
Subject: [PATCH] Updates code to have two memory ports per OCMB

ZEN:MST-1327
Change-Id: I00c29cb96914ef01ab099824c305d3214d2fec0c
---
 .../hwp/memory/lib/eff_config/explorer_attr_engine_traits.H           | 4 ++--
 src/import/chips/p10/procedures/hwp/memory/lib/freq/p10_freq_traits.H | 4 ++--
 src/import/generic/memory/lib/utils/shared/mss_generic_consts.H       | 2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/import/chips/ocmb/explorer/procedures/hwp/memory/lib/eff_config/explorer_attr_engine_traits.H b/src/import/chips/ocmb/explorer/procedures/hwp/memory/lib/eff_config/explorer_attr_engine_traits.H
index 2dcf258..516ee65 100644
--- a/src/import/chips/ocmb/explorer/procedures/hwp/memory/lib/eff_config/explorer_attr_engine_traits.H
+++ b/src/import/chips/ocmb/explorer/procedures/hwp/memory/lib/eff_config/explorer_attr_engine_traits.H
@@ -5,7 +5,7 @@
 /*                                                                        */
 /* OpenPOWER HostBoot Project                                             */
 /*                                                                        */
-/* Contributors Listed Below - COPYRIGHT 2019,2021                        */
+/* Contributors Listed Below - COPYRIGHT 2019,2022                        */
 /* [+] International Business Machines Corp.                              */
 /*                                                                        */
 /*                                                                        */
@@ -66,7 +66,7 @@ class dimmPosTraits<mss::mc_type::EXPLORER>
         using pos_type = PT::pos_type;
 
         // Proc 0 would be DIMM0 - 31,  proc 1 would be DIMM32 - 63, etc. 32 is the stride between processors
-        static constexpr auto DIMM_STRIDE_PER_PROC = 32;
+        static constexpr auto DIMM_STRIDE_PER_PROC = 64;
         static constexpr auto TOTAL_DIMM = MT::MC_PER_PROC * MT::MI_PER_MC * MT::MCC_PER_MI *
                                            MT::OMI_PER_MCC * MT::OCMB_PER_OMI * MT::PORTS_PER_OCMB * MT::DIMMS_PER_PORT;
 
diff --git a/src/import/chips/p10/procedures/hwp/memory/lib/freq/p10_freq_traits.H b/src/import/chips/p10/procedures/hwp/memory/lib/freq/p10_freq_traits.H
index a4e4457..51a15f0 100644
--- a/src/import/chips/p10/procedures/hwp/memory/lib/freq/p10_freq_traits.H
+++ b/src/import/chips/p10/procedures/hwp/memory/lib/freq/p10_freq_traits.H
@@ -5,7 +5,7 @@
 /*                                                                        */
 /* OpenPOWER HostBoot Project                                             */
 /*                                                                        */
-/* Contributors Listed Below - COPYRIGHT 2019,2021                        */
+/* Contributors Listed Below - COPYRIGHT 2019,2022                        */
 /* [+] International Business Machines Corp.                              */
 /*                                                                        */
 /*                                                                        */
@@ -64,7 +64,7 @@ class frequency_traits<mss::proc_type::PROC_P10>
         //////////////////////////////////////////////////////////////
         static const std::vector<uint64_t> SUPPORTED_FREQS;
         // PROC_CHIP is our frequency domain
-        static constexpr uint64_t PORTS_PER_FREQ_DOMAIN = 16;
+        static constexpr uint64_t PORTS_PER_FREQ_DOMAIN = 32;
         // Max DIMM's per port
         static constexpr uint64_t MAX_DIMM_PER_PORT = 2;
         // Maxium number of primary ranks on a DIMM
diff --git a/src/import/generic/memory/lib/utils/shared/mss_generic_consts.H b/src/import/generic/memory/lib/utils/shared/mss_generic_consts.H
index 96c5588..4b99d58 100644
--- a/src/import/generic/memory/lib/utils/shared/mss_generic_consts.H
+++ b/src/import/generic/memory/lib/utils/shared/mss_generic_consts.H
@@ -1191,7 +1191,7 @@ struct mcTypeTraits<mc_type::EXPLORER>
         MCC_PER_MI = 2,
         OMI_PER_MCC = 2,
         OCMB_PER_OMI = 1,
-        PORTS_PER_OCMB = 1,
+        PORTS_PER_OCMB = 2,
         DIMMS_PER_PORT = 2,
     };
 };
-- 
1.8.3.1

