From fc0ef339de60740ce360f9d4753e3151a62d8abb Mon Sep 17 00:00:00 2001
From: Jenny Huynh <jhuynh@us.ibm.com>
Date: Wed, 26 Feb 2020 17:20:44 -0500
Subject: [PATCH] Always set smf bit in xscom bar

Change-Id: Ib63a60c6790493a73200c42893ae8c591f0b48c7
---
 src/import/chips/p10/procedures/hwp/nest/p10_gen_xscom_init.C       | 6 +++---
 .../chips/p10/procedures/xml/attribute_info/p10_sbe_attributes.xml  | 4 ----
 2 files changed, 3 insertions(+), 7 deletions(-)

diff --git a/src/import/chips/p10/procedures/hwp/nest/p10_gen_xscom_init.C b/src/import/chips/p10/procedures/hwp/nest/p10_gen_xscom_init.C
index 0bf0266..02fa4d8 100644
--- a/src/import/chips/p10/procedures/hwp/nest/p10_gen_xscom_init.C
+++ b/src/import/chips/p10/procedures/hwp/nest/p10_gen_xscom_init.C
@@ -5,7 +5,7 @@
 /*                                                                        */
 /* OpenPOWER HostBoot Project                                             */
 /*                                                                        */
-/* Contributors Listed Below - COPYRIGHT 2019                             */
+/* Contributors Listed Below - COPYRIGHT 2019,2020                        */
 /* [+] International Business Machines Corp.                              */
 /*                                                                        */
 /*                                                                        */
@@ -138,8 +138,8 @@ p10_gen_xscom_init(
                                l_xscom_bar_base_addr_offset),
                  "Error from FAPI_ATTR_GET (ATTR_PROC_XSCOM_BAR_BASE_ADDR_OFFSET)");
 
-        l_xscom_addr = l_base_address_mmio +
-                       l_xscom_bar_base_addr_offset;
+        l_xscom_addr = l_base_address_mmio + l_xscom_bar_base_addr_offset;
+        l_xscom_addr |= FABRIC_ADDR_SMF_MASK;
 
         // merge SCOM/PIB address into position for XSCOM address
         // PIB address 1:31 -> XSCOM address 30:60
diff --git a/src/import/chips/p10/procedures/xml/attribute_info/p10_sbe_attributes.xml b/src/import/chips/p10/procedures/xml/attribute_info/p10_sbe_attributes.xml
index fbbaf71..1be95fa 100644
--- a/src/import/chips/p10/procedures/xml/attribute_info/p10_sbe_attributes.xml
+++ b/src/import/chips/p10/procedures/xml/attribute_info/p10_sbe_attributes.xml
@@ -469,10 +469,6 @@
     <value>0x0</value>
   </entry>
   <entry>
-    <name>ATTR_SMF_CONFIG</name>
-    <value>0x1</value>
-  </entry>
-  <entry>
     <name>ATTR_SBE_HBBL_EXCEPTION_INSTRUCT</name>
     <value>0x48000000</value>
   </entry>
-- 
1.8.2.2

